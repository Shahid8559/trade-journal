<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trade Journal Dashboard</title>

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0b0f1a;
      color: #e5e7eb;
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 220px;
      background: #0e1322;
      padding: 20px;
    }

    .logo {
      font-size: 20px;
      font-weight: bold;
      color: #a78bfa;
      margin-bottom: 20px;
    }

    .main {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat {
      background: #121826;
      padding: 16px;
      border-radius: 12px;
    }

    .calendar {
      background: #121826;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
    }

    .day {
      height: 90px;
      background: #1f2937;
      border-radius: 8px;
      padding: 6px;
      font-size: 12px;
    }

    .profit { background: #064e3b; }
    .loss { background: #3f1d25; }

    button {
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="sidebar">
  <div class="logo">ðŸ“ˆ Trade Journal</div>
</div>

<div class="main">

  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h1>Dashboard</h1>
    <button id="addTradeBtn"
      style="background:#7c3aed;color:white;border:none;padding:10px 14px;border-radius:8px;">
      + Add Trade
    </button>
  </div>

  <div class="stats">
    <div class="stat"><p>Total PnL</p><h2 id="totalPnl">$0</h2></div>
    <div class="stat"><p>Win Rate</p><h2 id="winRate">0%</h2></div>
    <div class="stat"><p>Wins</p><h2 id="winsCount">0</h2></div>
    <div class="stat"><p>Losses</p><h2 id="lossCount">0</h2></div>
  </div>

  <div class="calendar">
    <h3>Calendar</h3>
    <div class="calendar-grid">
      <div class="day" data-day="1">1</div>
      <div class="day" data-day="2">2</div>
      <div class="day" data-day="3">3</div>
      <div class="day" data-day="4">4</div>
      <div class="day" data-day="5">5</div>
      <div class="day" data-day="6">6</div>
      <div class="day" data-day="7">7</div>
    </div>
  </div>

  <div style="margin-top:30px;background:#121826;padding:20px;border-radius:12px;">
  <h3>Performance</h3>

  <div style="margin-bottom:8px;font-size:14px;">
    Max Drawdown: <strong id="maxDD">0%</strong>
  </div>

  <canvas id="equityChart" width="800" height="200" style="width:100%;"></canvas>

  <canvas id="ddChart" width="800" height="120"
    style="width:100%;margin-top:12px;"></canvas>
</div>


</div>

<!-- MODAL -->
<div id="tradeModal" style="
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;align-items:center;justify-content:center;
">
  <div style="background:#121826;padding:20px;border-radius:12px;width:300px;">
    <h3>Add Trade</h3>

    <input id="pnlInput" type="number" placeholder="PnL"
      style="width:100%;padding:8px;margin:8px 0">
   <button onclick="closeModal()">Cancel</button>
      width:100%;background:#22c55e;border:none;
      padding:10px;border-radius:8px;">
      Save Trade
    </button>

    <button onclick="closeModal()" style="
      width:100%;margin-top:8px;background:#374151;
      border:none;padding:10px;border-radius:8px;color:white;">
      Cancel
    </button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const modal = document.getElementById("tradeModal");
  const addBtn = document.getElementById("addTradeBtn");

  let trades = JSON.parse(localStorage.getItem("trades")) || [];

  addBtn.onclick = () => {
    addBtn.disabled = true;
    modal.style.display = "flex";
  };

  window.closeModal = () => {
    addBtn.disabled = false;
    modal.style.display = "none";
    addBtn.disabled = false;
  };

  window.saveTrade = (btn) => {
    btn.disabled = true;
    const pnl = Number(document.getElementById("pnlInput").value);
    if (isNaN(pnl)) { btn.disabled = false; return; }

    trades.push({ pnl, day: new Date().getDate() });
    localStorage.setItem("trades", JSON.stringify(trades));

    document.getElementById("pnlInput").value = "";
    btn.disabled = false;
    closeModal();
    update();
  };

  function update() {
    let total = 0, wins = 0;
    const dayTotals = {};

    trades.forEach(t => {
      total += t.pnl;
      if (t.pnl > 0) wins++;
      dayTotals[t.day] = (dayTotals[t.day] || 0) + t.pnl;
    });

    document.getElementById("totalPnl").innerText = "$" + total;
    document.getElementById("winRate").innerText =
      trades.length ? Math.round(wins / trades.length * 100) + "%" : "0%";
    document.getElementById("winsCount").innerText = wins;
    document.getElementById("lossCount").innerText = trades.length - wins;

    document.querySelectorAll(".day").forEach(d => {
      const day = Number(d.dataset.day);
      const val = dayTotals[day];
      d.className = "day";
      d.innerHTML = day;
      if (val > 0) { d.classList.add("profit"); d.innerHTML += "<br>+$"+val; }
      if (val < 0) { d.classList.add("loss"); d.innerHTML += "<br>-$"+Math.abs(val); }
    });

    drawChart();
  }

function drawChart() {
  const eqCanvas = document.getElementById("equityChart");
  const ddCanvas = document.getElementById("ddChart");

  const eqCtx = eqCanvas.getContext("2d");
  const ddCtx = ddCanvas.getContext("2d");

  eqCtx.clearRect(0, 0, eqCanvas.width, eqCanvas.height);
  ddCtx.clearRect(0, 0, ddCanvas.width, ddCanvas.height);

  let equity = 0;
  let peak = 0;
  let maxDrawdown = 0;

  const equityPoints = [];
  const ddPoints = [];

  trades.forEach(t => {
    equity += t.pnl;
    peak = Math.max(peak, equity);

    const dd = peak === 0 ? 0 : ((equity - peak) / peak) * 100;

    equityPoints.push(equity);
    ddPoints.push(dd);

    maxDrawdown = Math.min(maxDrawdown, dd);
  });

  document.getElementById("maxDD").innerText =
    maxDrawdown.toFixed(2) + "%";

  drawLine(eqCtx, eqCanvas, equityPoints, "#22c55e");
  drawLine(ddCtx, ddCanvas, ddPoints, "#ef4444");
}
function drawLine(ctx, canvas, points, color) {
  if (!points.length) return;

  const max = Math.max(...points);
  const min = Math.min(...points);
  const range = max - min || 1;

  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;

  points.forEach((v, i) => {
    const x = (i / (points.length - 1 || 1)) * canvas.width;
    const y =
      canvas.height -
      ((v - min) / range) * canvas.height;

    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });

  ctx.stroke();
}
</script>

</body>
</html>
